<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realtime Weather - 2026-02-22</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            margin: 0;
            overflow-x: hidden;
            background-color: #f8fafc;
        }

        /* Animated Mesh Gradient Background */
        .bg-mesh {
            background: linear-gradient(-45deg, #ff9a9e, #fecfef, #a1c4fd, #c2e9fb);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
        }

        .float-anim { animation: floating 3s ease-in-out infinite; }
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .loader {
            border: 3px solid rgba(255,255,255,0.4);
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Custom Scrollbar for selects */
        select::-webkit-scrollbar { width: 8px; }
        select::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 4px; }
        select::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
    </style>
</head>
<body class="text-gray-800 antialiased flex flex-col items-center justify-center min-h-screen p-4 md:p-8">

    <div class="bg-mesh"></div>

    <main class="glass-panel rounded-[2.5rem] p-6 md:p-8 w-full max-w-lg relative flex flex-col gap-6">
        
        <header class="text-center mb-2">
            <h1 class="text-2xl font-extrabold tracking-tight text-gray-900 mb-1">동네 실시간 날씨</h1>
            <p id="currentTimeDisplay" class="text-sm font-medium text-gray-600">시간 동기화 중...</p>
        </header>

        <!-- 3-Depth Region Selectors -->
        <div class="glass-card rounded-2xl p-4 flex flex-col gap-3">
            <div class="text-xs font-semibold text-gray-500 uppercase tracking-widest px-1">지역 선택</div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <select id="sidoSelect" class="w-full bg-white/50 border border-white/60 text-gray-800 text-sm rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 block p-2.5 outline-none transition cursor-pointer font-medium" onchange="onSidoChange()">
                    <option value="">시/도 선택</option>
                </select>
                <select id="sigunguSelect" class="w-full bg-white/50 border border-white/60 text-gray-800 text-sm rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 block p-2.5 outline-none transition cursor-pointer font-medium" onchange="onSigunguChange()" disabled>
                    <option value="">시/군/구 선택</option>
                </select>
                <select id="dongSelect" class="w-full bg-white/50 border border-white/60 text-gray-800 text-sm rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 block p-2.5 outline-none transition cursor-pointer font-medium" onchange="onDongChange()" disabled>
                    <option value="">읍/면/동 선택</option>
                </select>
            </div>
        </div>

        <!-- State Containers -->
        <div id="loadingState" class="flex flex-col items-center justify-center py-10">
            <div class="loader mb-4"></div>
            <p class="text-gray-600 font-medium animate-pulse text-sm">기상청 데이터를 분석하고 있습니다...</p>
        </div>

        <div id="errorState" class="hidden flex-col items-center justify-center py-10 text-center">
            <div class="bg-red-100 p-3 rounded-full mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            </div>
            <p id="errorMessage" class="text-red-500 font-bold mb-1">데이터를 불러올 수 없습니다.</p>
            <p class="text-xs text-gray-500">통신 지연이 발생했습니다. 다시 지역을 선택해주세요.</p>
        </div>

        <div id="emptyState" class="hidden flex-col items-center justify-center py-10 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mb-3 opacity-50"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            <p class="text-gray-500 font-medium">상단에서 지역을 끝까지 선택해주세요.</p>
        </div>

        <!-- Weather Content -->
        <div id="weatherContent" class="hidden flex-col gap-6">
            <div class="flex flex-col items-center justify-center pt-2">
                <div id="weatherIconContainer" class="float-anim drop-shadow-xl mb-3"></div>
                <div class="flex items-start">
                    <span id="temperature" class="text-7xl font-black tracking-tighter text-gray-900 drop-shadow-sm">-</span>
                    <span class="text-4xl font-bold text-gray-500 mt-2">°</span>
                </div>
                <p id="weatherDesc" class="text-base font-bold text-indigo-700 mt-3 bg-white/60 px-5 py-1.5 rounded-full shadow-sm border border-white/80">확인 중</p>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="glass-card rounded-2xl p-4 flex items-center gap-3">
                    <div class="bg-blue-500/10 p-2.5 rounded-xl text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22a5 5 0 0 0 5-5c0-2-2.5-7-5-12-2.5 5-5 10-5 12a5 5 0 0 0 5 5z"/></svg>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">습도</p>
                        <p id="humidity" class="text-lg font-extrabold text-gray-800">-%</p>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-4 flex items-center gap-3">
                    <div class="bg-gray-500/10 p-2.5 rounded-xl text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">풍속</p>
                        <p id="windSpeed" class="text-lg font-extrabold text-gray-800">- m/s</p>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-4 flex items-center gap-4 col-span-2">
                    <div class="bg-indigo-500/10 p-3 rounded-xl text-indigo-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 16.2A4.5 4.5 0 0 0 17.5 8h-1.8A7 7 0 1 0 4 14.9"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>
                    </div>
                    <div class="flex-1 flex justify-between items-center">
                        <div>
                            <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">1시간 강수량</p>
                            <p id="precipitation" class="text-xl font-black text-gray-800">- mm</p>
                        </div>
                        <p id="rainStatus" class="text-xs font-bold text-indigo-600 bg-white/80 px-3 py-1.5 rounded-lg border border-indigo-100 shadow-sm">-</p>
                    </div>
                </div>
            </div>
            <p class="text-center text-[10px] text-gray-400 mt-1 font-medium">실황 정보는 구름량을 제공하지 않아 맑음/비/눈으로만 표기됩니다.</p>
        </div>
    </main>

    <script>
        const SERVICE_KEY = "OaRLlfpKOXJH%2BFeghkAojoaSAQbb1bkFF9COvGfjixpiLkEYTHFLqIcBYqFb0HCrcX8H3A47X9QNiRpgcCXAOA%3D%3D";

        const icons = {
            sun: `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="#fcd34d" stroke="#f59e0b" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>`,
            rain: `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="#bfdbfe" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 16.2A4.5 4.5 0 0 0 17.5 8h-1.8A7 7 0 1 0 4 14.9"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>`,
            snow: `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="#f3f4f6" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 16.2A4.5 4.5 0 0 0 17.5 8h-1.8A7 7 0 1 0 4 14.9"/><path d="M8 15h.01"/><path d="M8 19h.01"/><path d="M12 17h.01"/><path d="M12 21h.01"/><path d="M16 15h.01"/><path d="M16 19h.01"/></svg>`
        };

        // 전국 모든 시/군/구 대표 좌표 데이터 적용
        const rawRegionData = [
            "서울특별시|종로구|대표지역|60|127", "서울특별시|중구|대표지역|60|127", "서울특별시|용산구|대표지역|60|126", "서울특별시|성동구|대표지역|61|127", "서울특별시|광진구|대표지역|62|126", "서울특별시|동대문구|대표지역|61|127", "서울특별시|중랑구|대표지역|62|127", "서울특별시|성북구|대표지역|61|127", "서울특별시|강북구|대표지역|61|128", "서울특별시|도봉구|대표지역|61|128", "서울특별시|노원구|대표지역|61|128", "서울특별시|은평구|대표지역|59|127", "서울특별시|서대문구|대표지역|59|127", "서울특별시|마포구|대표지역|59|127", "서울특별시|양천구|대표지역|58|126", "서울특별시|강서구|대표지역|58|126", "서울특별시|구로구|대표지역|58|125", "서울특별시|금천구|대표지역|59|125", "서울특별시|영등포구|대표지역|60|126", "서울특별시|동작구|대표지역|59|125", "서울특별시|관악구|대표지역|59|125", "서울특별시|서초구|대표지역|61|125", "서울특별시|강남구|대표지역|61|126", "서울특별시|송파구|대표지역|62|126", "서울특별시|강동구|대표지역|63|126",
            "부산광역시|중구|대표지역|97|74", "부산광역시|서구|대표지역|97|74", "부산광역시|동구|대표지역|98|75", "부산광역시|영도구|대표지역|98|74", "부산광역시|부산진구|대표지역|97|75", "부산광역시|동래구|대표지역|98|76", "부산광역시|남구|대표지역|98|75", "부산광역시|북구|대표지역|96|76", "부산광역시|해운대구|대표지역|99|75", "부산광역시|사하구|대표지역|96|74", "부산광역시|금정구|대표지역|98|76", "부산광역시|강서구|대표지역|96|76", "부산광역시|연제구|대표지역|98|76", "부산광역시|수영구|대표지역|99|75", "부산광역시|사상구|대표지역|96|75", "부산광역시|기장군|대표지역|100|77",
            "대구광역시|중구|대표지역|89|90", "대구광역시|동구|대표지역|90|91", "대구광역시|서구|대표지역|88|90", "대구광역시|남구|대표지역|89|90", "대구광역시|북구|대표지역|89|91", "대구광역시|수성구|대표지역|89|90", "대구광역시|달서구|대표지역|88|90", "대구광역시|달성군|대표지역|86|89", "대구광역시|군위군|대표지역|88|98",
            "인천광역시|중구|대표지역|54|125", "인천광역시|동구|대표지역|54|125", "인천광역시|미추홀구|대표지역|54|124", "인천광역시|연수구|대표지역|54|124", "인천광역시|남동구|대표지역|56|124", "인천광역시|부평구|대표지역|55|125", "인천광역시|계양구|대표지역|55|126", "인천광역시|서구|대표지역|55|126", "인천광역시|강화군|대표지역|51|130", "인천광역시|옹진군|대표지역|51|125",
            "광주광역시|동구|대표지역|59|74", "광주광역시|서구|대표지역|59|74", "광주광역시|남구|대표지역|59|74", "광주광역시|북구|대표지역|59|75", "광주광역시|광산구|대표지역|57|74",
            "대전광역시|동구|대표지역|68|133", "대전광역시|중구|대표지역|68|133", "대전광역시|서구|대표지역|67|133", "대전광역시|유성구|대표지역|67|132", "대전광역시|대덕구|대표지역|68|133",
            "울산광역시|중구|대표지역|102|84", "울산광역시|남구|대표지역|102|84", "울산광역시|동구|대표지역|104|83", "울산광역시|북구|대표지역|103|85", "울산광역시|울주군|대표지역|102|82",
            "세종특별자치시|세종시|대표지역|66|119",
            "경기도|수원시|대표지역|60|121", "경기도|성남시|대표지역|63|124", "경기도|고양시|대표지역|57|128", "경기도|용인시|대표지역|64|120", "경기도|부천시|대표지역|57|125", "경기도|안산시|대표지역|58|121", "경기도|안양시|대표지역|59|123", "경기도|남양주시|대표지역|64|128", "경기도|화성시|대표지역|57|119", "경기도|평택시|대표지역|61|114", "경기도|의정부시|대표지역|61|130", "경기도|시흥시|대표지역|57|123", "경기도|파주시|대표지역|56|131", "경기도|김포시|대표지역|55|128", "경기도|광명시|대표지역|58|125", "경기도|광주시|대표지역|65|123", "경기도|군포시|대표지역|59|122", "경기도|오산시|대표지역|62|118", "경기도|이천시|대표지역|68|121", "경기도|양주시|대표지역|61|131", "경기도|안성시|대표지역|65|115", "경기도|구리시|대표지역|62|127", "경기도|포천시|대표지역|64|134", "경기도|의왕시|대표지역|60|122", "경기도|하남시|대표지역|64|126", "경기도|여주시|대표지역|71|121", "경기도|동두천시|대표지역|61|134", "경기도|과천시|대표지역|60|124", "경기도|가평군|대표지역|69|133", "경기도|양평군|대표지역|69|125", "경기도|연천군|대표지역|61|138",
            "강원특별자치도|춘천시|대표지역|73|134", "강원특별자치도|원주시|대표지역|76|122", "강원특별자치도|강릉시|대표지역|92|133", "강원특별자치도|동해시|대표지역|97|127", "강원특별자치도|태백시|대표지역|95|119", "강원특별자치도|속초시|대표지역|87|141", "강원특별자치도|삼척시|대표지역|98|125", "강원특별자치도|홍천군|대표지역|77|130", "강원특별자치도|횡성군|대표지역|77|125", "강원특별자치도|영월군|대표지역|86|119", "강원특별자치도|평창군|대표지역|84|123", "강원특별자치도|정선군|대표지역|89|122", "강원특별자치도|철원군|대표지역|65|139", "강원특별자치도|화천군|대표지역|72|139", "강원특별자치도|양구군|대표지역|77|139", "강원특별자치도|인제군|대표지역|84|137", "강원특별자치도|고성군|대표지역|85|145", "강원특별자치도|양양군|대표지역|88|138",
            "충청북도|청주시|대표지역|69|106", "충청북도|충주시|대표지역|76|114", "충청북도|제천시|대표지역|81|118", "충청북도|보은군|대표지역|73|103", "충청북도|옥천군|대표지역|73|97", "충청북도|영동군|대표지역|74|90", "충청북도|증평군|대표지역|71|110", "충청북도|진천군|대표지역|68|111", "충청북도|괴산군|대표지역|74|111", "충청북도|음성군|대표지역|71|115", "충청북도|단양군|대표지역|84|115",
            "충청남도|천안시|대표지역|63|111", "충청남도|공주시|대표지역|60|113", "충청남도|보령시|대표지역|53|100", "충청남도|아산시|대표지역|60|116", "충청남도|서산시|대표지역|51|110", "충청남도|논산시|대표지역|62|102", "충청남도|계룡시|대표지역|65|106", "충청남도|당진시|대표지역|53|114", "충청남도|금산군|대표지역|69|98", "충청남도|부여군|대표지역|56|101", "충청남도|서천군|대표지역|53|93", "충청남도|청양군|대표지역|57|106", "충청남도|홍성군|대표지역|54|106", "충청남도|예산군|대표지역|58|109", "충청남도|태안군|대표지역|48|109",
            "전북특별자치도|전주시|대표지역|63|89", "전북특별자치도|군산시|대표지역|56|92", "전북특별자치도|익산시|대표지역|60|91", "전북특별자치도|정읍시|대표지역|58|83", "전북특별자치도|남원시|대표지역|68|80", "전북특별자치도|김제시|대표지역|59|88", "전북특별자치도|완주군|대표지역|63|89", "전북특별자치도|진안군|대표지역|68|88", "전북특별자치도|무주군|대표지역|72|93", "전북특별자치도|장수군|대표지역|70|85", "전북특별자치도|임실군|대표지역|66|84", "전북특별자치도|순창군|대표지역|63|79", "전북특별자치도|고창군|대표지역|56|80", "전북특별자치도|부안군|대표지역|56|87",
            "전라남도|목포시|대표지역|50|67", "전라남도|여수시|대표지역|74|61", "전라남도|순천시|대표지역|70|70", "전라남도|나주시|대표지역|56|71", "전라남도|광양시|대표지역|73|70", "전라남도|담양군|대표지역|61|78", "전라남도|곡성군|대표지역|66|77", "전라남도|구례군|대표지역|69|75", "전라남도|고흥군|대표지역|66|62", "전라남도|보성군|대표지역|62|66", "전라남도|화순군|대표지역|61|72", "전라남도|장흥군|대표지역|59|64", "전라남도|강진군|대표지역|57|63", "전라남도|해남군|대표지역|54|61", "전라남도|영암군|대표지역|56|66", "전라남도|무안군|대표지역|52|71", "전라남도|함평군|대표지역|52|73", "전라남도|영광군|대표지역|52|77", "전라남도|장성군|대표지역|59|77", "전라남도|완도군|대표지역|57|56", "전라남도|진도군|대표지역|46|57", "전라남도|신안군|대표지역|50|66",
            "경상북도|포항시|대표지역|102|94", "경상북도|경주시|대표지역|96|93", "경상북도|김천시|대표지역|80|96", "경상북도|안동시|대표지역|91|106", "경상북도|구미시|대표지역|84|96", "경상북도|영주시|대표지역|89|111", "경상북도|영천시|대표지역|95|93", "경상북도|상주시|대표지역|81|102", "경상북도|문경시|대표지역|81|106", "경상북도|경산시|대표지역|91|90", "경상북도|의성군|대표지역|90|101", "경상북도|청송군|대표지역|96|103", "경상북도|영양군|대표지역|97|108", "경상북도|영덕군|대표지역|102|103", "경상북도|청도군|대표지역|91|86", "경상북도|고령군|대표지역|83|87", "경상북도|성주군|대표지역|83|91", "경상북도|칠곡군|대표지역|85|93", "경상북도|예천군|대표지역|85|107", "경상북도|봉화군|대표지역|90|113", "경상북도|울진군|대표지역|102|115", "경상북도|울릉군|대표지역|127|127",
            "경상남도|창원시|대표지역|90|77", "경상남도|진주시|대표지역|81|74", "경상남도|통영시|대표지역|87|68", "경상남도|사천시|대표지역|80|71", "경상남도|김해시|대표지역|95|77", "경상남도|밀양시|대표지역|94|83", "경상남도|거제시|대표지역|90|69", "경상남도|양산시|대표지역|97|79", "경상남도|의령군|대표지역|83|78", "경상남도|함안군|대표지역|86|77", "경상남도|창녕군|대표지역|87|83", "경상남도|고성군|대표지역|85|71", "경상남도|남해군|대표지역|77|68", "경상남도|하동군|대표지역|74|73", "경상남도|산청군|대표지역|76|80", "경상남도|함양군|대표지역|74|82", "경상남도|거창군|대표지역|77|88", "경상남도|합천군|대표지역|81|84",
            "제주특별자치도|제주시|대표지역|53|38", "제주특별자치도|서귀포시|대표지역|52|33"
        ];

        // 파싱 로직
        const regionMap = {};
        rawRegionData.forEach(item => {
            const [sido, sigungu, dong, nx, ny] = item.split('|');
            if (!regionMap[sido]) regionMap[sido] = {};
            if (!regionMap[sido][sigungu]) regionMap[sido][sigungu] = {};
            regionMap[sido][sigungu][dong] = { nx, ny };
        });

        const elSido = document.getElementById('sidoSelect');
        const elSigungu = document.getElementById('sigunguSelect');
        const elDong = document.getElementById('dongSelect');

        // 초기 시/도 옵션 세팅
        function initSelectors() {
            Object.keys(regionMap).sort().forEach(sido => {
                const opt = document.createElement('option');
                opt.value = sido;
                opt.text = sido;
                elSido.appendChild(opt);
            });
            updateDisplayTime();
            
            // 초기 화면 설정 (서울특별시 종로구 대표지역 기본 선택)
            elSido.value = "서울특별시";
            onSidoChange();
            elSigungu.value = "종로구";
            onSigunguChange();
            elDong.value = "대표지역";
            onDongChange();
        }

        // 시/도 변경 시 시군구 세팅
        function onSidoChange() {
            const sido = elSido.value;
            elSigungu.innerHTML = '<option value="">시/군/구 선택</option>';
            elDong.innerHTML = '<option value="">읍/면/동 선택</option>';
            elSigungu.disabled = !sido;
            elDong.disabled = true;
            resetUI();

            if (sido) {
                Object.keys(regionMap[sido]).sort().forEach(sigungu => {
                    const opt = document.createElement('option');
                    opt.value = sigungu;
                    opt.text = sigungu;
                    elSigungu.appendChild(opt);
                });
            }
        }

        // 시군구 변경 시 동 세팅
        function onSigunguChange() {
            const sido = elSido.value;
            const sigungu = elSigungu.value;
            elDong.innerHTML = '<option value="">읍/면/동 선택</option>';
            elDong.disabled = !sigungu;
            resetUI();

            if (sigungu) {
                Object.keys(regionMap[sido][sigungu]).sort().forEach(dong => {
                    const opt = document.createElement('option');
                    opt.value = dong;
                    opt.text = dong;
                    elDong.appendChild(opt);
                });
            }
        }

        // 동 변경 시 날씨 호출
        function onDongChange() {
            const sido = elSido.value;
            const sigungu = elSigungu.value;
            const dong = elDong.value;
            
            if (dong) {
                const { nx, ny } = regionMap[sido][sigungu][dong];
                fetchWeatherData(nx, ny);
            } else {
                resetUI();
            }
        }

        // UI 상태 초기화
        function resetUI() {
            document.getElementById('weatherContent').classList.add('hidden');
            document.getElementById('weatherContent').classList.remove('flex');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('flex');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('flex');
            
            if (!elDong.value) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('emptyState').classList.add('flex');
            } else {
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('flex');
            }
        }

        function getBaseDateTime() {
            const now = new Date();
            let year = now.getFullYear();
            let month = now.getMonth() + 1;
            let day = now.getDate();
            let hours = now.getHours();
            let minutes = now.getMinutes();

            // 초단기실황은 매시간 40분에 발표됨
            if (minutes < 40) {
                hours -= 1;
                if (hours < 0) {
                    now.setDate(now.getDate() - 1);
                    year = now.getFullYear();
                    month = now.getMonth() + 1;
                    day = now.getDate();
                    hours = 23;
                }
            }

            const base_date = `${year}${String(month).padStart(2, '0')}${String(day).padStart(2, '0')}`;
            const base_time = `${String(hours).padStart(2, '0')}00`;
            return { base_date, base_time };
        }

        function updateDisplayTime() {
            const now = new Date();
            const dateString = "2026-02-22"; // 2026.0.0. 날짜 룰 적용
            const timeString = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('currentTimeDisplay').innerText = `${dateString} ${timeString} 기준`;
        }

        async function fetchWeatherData(nx, ny) {
            resetUI();
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('flex');
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('loadingState').classList.add('flex');
            
            updateDisplayTime();

            const { base_date, base_time } = getBaseDateTime();
            const url = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst?serviceKey=${SERVICE_KEY}&pageNo=1&numOfRows=100&dataType=JSON&base_date=${base_date}&base_time=${base_time}&nx=${nx}&ny=${ny}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("네트워크 응답 오류");
                
                const data = await response.json();
                
                if (data.response && data.response.header && data.response.header.resultCode === "00") {
                    const items = data.response.body.items.item;
                    let temp = "-", humidity = "-", wind = "-", rain1h = "-", ptyCode = "0";

                    items.forEach(item => {
                        switch(item.category) {
                            case 'T1H': temp = item.obsrValue; break;
                            case 'REH': humidity = item.obsrValue; break;
                            case 'WSD': wind = item.obsrValue; break;
                            case 'RN1': rain1h = item.obsrValue; break;
                            case 'PTY': ptyCode = item.obsrValue; break;
                        }
                    });

                    document.getElementById('temperature').innerText = temp;
                    document.getElementById('humidity').innerText = `${humidity}%`;
                    document.getElementById('windSpeed').innerText = `${wind} m/s`;
                    
                    const rainVal = parseFloat(rain1h);
                    document.getElementById('precipitation').innerText = rainVal > 0 ? `${rain1h} mm` : "0 mm";

                    let desc = "맑음/흐림";
                    let iconCode = icons.sun;
                    let rainStat = "강수 없음";

                    if (ptyCode === "1" || ptyCode === "5") {
                        desc = "비";
                        iconCode = icons.rain;
                        rainStat = "비 내림";
                    } else if (ptyCode === "2" || ptyCode === "6") {
                        desc = "진눈깨비";
                        iconCode = icons.rain;
                        rainStat = "진눈깨비 내림";
                    } else if (ptyCode === "3" || ptyCode === "7") {
                        desc = "눈";
                        iconCode = icons.snow;
                        rainStat = "눈 내림";
                    }

                    document.getElementById('weatherDesc').innerText = desc;
                    document.getElementById('rainStatus').innerText = rainStat;
                    document.getElementById('weatherIconContainer').innerHTML = iconCode;

                    document.getElementById('loadingState').classList.add('hidden');
                    document.getElementById('loadingState').classList.remove('flex');
                    document.getElementById('weatherContent').classList.remove('hidden');
                    document.getElementById('weatherContent').classList.add('flex');

                } else {
                    throw new Error(data.response?.header?.resultMsg || "API 데이터 오류");
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('loadingState').classList.remove('flex');
                document.getElementById('errorState').classList.remove('hidden');
                document.getElementById('errorState').classList.add('flex');
                
                if(error.message.includes('네트워크') || error.message.includes('Failed to fetch')) {
                     document.getElementById('errorMessage').innerText = "네트워크 통신 오류 발생";
                } else {
                     document.getElementById('errorMessage').innerText = "해당 지역의 데이터 응답이 없습니다.";
                }
            }
        }

        // 초기화 실행
        window.onload = initSelectors;
        setInterval(updateDisplayTime, 60000);

    </script>
</body>
</html>
